<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–§–∏–Ω–∞–Ω—Å—ã ‚Ä¢ iOS 26</title>
    
    <!-- iOS Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Pages Container -->
        <div class="pages-container">
            
            <!-- === PAGE 1: PANEL === -->
            <div id="panel-page" class="page active">
                <!-- Balance Card -->
                <div class="balance-card">
                    <div class="balance-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                    <div class="balance-amount" id="balance">0 ‚ÇΩ</div>
                    <div class="balance-subtitle">–í—Å–µ –≤–∞—à–∏ –∞–∫—Ç–∏–≤—ã</div>
                </div>

                <!-- Incomes (Compact) -->
                <div class="category-section">
                    <div class="section-header">
                        <div class="section-title">–î–æ—Ö–æ–¥—ã</div>
                        <button class="section-action" onclick="showAllCategories('income')">–í—Å–µ</button>
                    </div>
                    <div class="compact-category-grid" id="compact-income-categories">
                        <!-- Dynamic (3 max) -->
                    </div>
                    <button class="add-category-btn" onclick="showAddCategoryModal('income')">
                        <span>+</span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
                    </button>
                </div>

                <!-- Expenses (Compact) -->
                <div class="category-section">
                    <div class="section-header">
                        <div class="section-title">–†–∞—Å—Ö–æ–¥—ã</div>
                        <button class="section-action" onclick="showAllCategories('expense')">–í—Å–µ</button>
                    </div>
                    <div class="compact-category-grid" id="compact-expense-categories">
                        <!-- Dynamic (3 max) -->
                    </div>
                    <button class="add-category-btn" onclick="showAddCategoryModal('expense')">
                        <span>+</span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
                    </button>
                </div>

                <!-- Wallets (Compact) -->
                <div class="category-section">
                    <div class="section-header">
                        <div class="section-title">–ö–æ—à–µ–ª—å–∫–∏</div>
                        <button class="section-action" onclick="showAllWallets()">–í—Å–µ</button>
                    </div>
                    <div class="compact-category-grid" id="compact-wallet-categories">
                        <!-- Dynamic (3 max) -->
                    </div>
                    <button class="add-category-btn" onclick="showAddWalletModal()">
                        <span>+</span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</span>
                    </button>
                </div>

                <!-- Recent Transactions -->
                <div class="recent-transactions">
                    <div class="section-header">
                        <div class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                        <button class="section-action" onclick="showAllTransactions()">–í—Å–µ</button>
                    </div>
                    <div id="recent-transactions-list">
                        <!-- Dynamic -->
                    </div>
                </div>
            </div>

            <!-- === PAGE 2: HISTORY === -->
            <div id="history-page" class="page">
                <!-- Month Selector -->
                <div class="month-selector">
                    <button class="month-nav" id="prev-month">‚Üê</button>
                    <div class="month-display" id="current-month" onclick="showCalendar()">—Ñ–µ–≤—Ä–∞–ª—å 2026</div>
                    <button class="month-nav" id="next-month">‚Üí</button>
                </div>

                <!-- Filters -->
                <div class="history-filters">
                    <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                    <button class="filter-btn" data-filter="income">–î–æ—Ö–æ–¥—ã</button>
                    <button class="filter-btn" data-filter="expense">–†–∞—Å—Ö–æ–¥—ã</button>
                </div>

                <!-- Transactions List -->
                <div class="transactions-list" id="month-transactions">
                    <!-- Dynamic -->
                </div>
            </div>

            <!-- === PAGE 3: REPORT === -->
            <div id="report-page" class="page">
                <!-- Report Tabs -->
                <div class="report-tabs-container">
                    <div class="report-tabs-scroll">
                        <button class="report-tab-ios active" data-tab="overview">–û–±–∑–æ—Ä</button>
                        <button class="report-tab-ios" data-tab="income">–î–æ—Ö–æ–¥—ã</button>
                        <button class="report-tab-ios" data-tab="expense">–†–∞—Å—Ö–æ–¥—ã</button>
                        <button class="report-tab-ios" data-tab="savings">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</button>
                        <button class="report-tab-ios" data-tab="balance">–ë–∞–ª–∞–Ω—Å</button>
                    </div>
                </div>

                <!-- Report Content -->
                <div class="report-content">
                    <!-- TAB 1: OVERVIEW -->
                    <div id="tab-overview" class="report-section active">
                        <!-- Total Balance -->
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                            <div class="balance-overview">
                                <div class="balance-amount-large" id="overview-balance">0 ‚ÇΩ</div>
                                <div class="balance-subtitle">–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                            </div>
                        </div>

                        <!-- Ratio Chart -->
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</div>
                            <div class="chart-wrapper-ios">
                                <canvas id="ratio-chart"></canvas>
                            </div>
                            <div class="chart-legend-ios" id="ratio-legend">
                                <!-- Dynamic -->
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: INCOME -->
                    <div id="tab-income" class="report-section">
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–î–æ—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
                            <div class="chart-wrapper-ios">
                                <canvas id="income-chart"></canvas>
                            </div>
                            <div class="chart-legend-ios" id="income-legend">
                                <!-- Dynamic -->
                            </div>
                        </div>
                    </div>

                    <!-- TAB 3: EXPENSE -->
                    <div id="tab-expense" class="report-section">
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
                            <div class="chart-wrapper-ios">
                                <canvas id="expense-chart"></canvas>
                            </div>
                            <div class="chart-legend-ios" id="expense-legend">
                                <!-- Dynamic -->
                            </div>
                        </div>
                    </div>

                    <!-- TAB 4: SAVINGS -->
                    <div id="tab-savings" class="report-section">
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø–æ —Ü–µ–ª—è–º</div>
                            <div class="chart-wrapper-ios">
                                <canvas id="savings-chart"></canvas>
                            </div>
                            <div class="chart-legend-ios" id="savings-legend">
                                <!-- Dynamic -->
                            </div>
                        </div>

                        <!-- Goals List -->
                        <div class="goals-section">
                            <div class="section-header">
                                <div class="section-title">–ú–æ–∏ —Ü–µ–ª–∏</div>
                                <button class="section-action" onclick="showAddGoalModal()">+</button>
                            </div>
                            <div id="goals-list">
                                <!-- Dynamic -->
                            </div>
                        </div>
                    </div>

                    <!-- TAB 5: BALANCE -->
                    <div id="tab-balance" class="report-section">
                        <!-- Dynamics Controls -->
                        <div class="dynamics-controls">
                            <button class="dynamics-period active" data-period="days">–î–Ω–∏</button>
                            <button class="dynamics-period" data-period="weeks">–ù–µ–¥–µ–ª–∏</button>
                            <button class="dynamics-period" data-period="months">–ú–µ—Å—è—Ü—ã</button>
                        </div>

                        <!-- Dynamics Chart -->
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–î–∏–Ω–∞–º–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∞</div>
                            <div class="chart-wrapper-ios">
                                <canvas id="dynamics-chart"></canvas>
                            </div>
                        </div>

                        <!-- Distribution Chart -->
                        <div class="chart-container-ios">
                            <div class="chart-title-ios">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ—à–µ–ª—å–∫–∞–º</div>
                            <div class="chart-wrapper-ios">
                                <canvas id="distribution-chart"></canvas>
                            </div>
                            <div class="chart-legend-ios" id="distribution-legend">
                                <!-- Dynamic -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === PAGE 4: SERVICES === -->
            <div id="services-page" class="page">
                <div class="services-section">
                    <!-- Currency -->
                    <div class="service-card">
                        <div class="service-title">–í–∞–ª—é—Ç–∞</div>
                        <div class="currency-options">
                            <button class="currency-option active" data-currency="RUB" onclick="selectCurrency('RUB')">
                                <span>‚ÇΩ</span> RUB
                            </button>
                            <button class="currency-option" data-currency="USD" onclick="selectCurrency('USD')">
                                <span>$</span> USD
                            </button>
                            <button class="currency-option" data-currency="EUR" onclick="selectCurrency('EUR')">
                                <span>‚Ç¨</span> EUR
                            </button>
                            <button class="currency-option" data-currency="GEL" onclick="selectCurrency('GEL')">
                                <span>‚Çæ</span> GEL
                            </button>
                        </div>
                    </div>

                    <!-- Export -->
                    <div class="service-card">
                        <div class="service-title">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                        <div class="export-actions">
                            <button class="modal-btn secondary" onclick="exportData()">
                                <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                            </button>
                        </div>
                    </div>

                    <!-- About -->
                    <div class="service-card">
                        <div class="service-title">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
                        <div class="about-content">
                            <div class="app-icon">üí∞</div>
                            <div class="app-info">
                                <div class="app-name">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</div>
                                <div class="app-version">–í–µ—Ä—Å–∏—è 2.2 ‚Ä¢ iOS 26</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="panel">
                <span class="nav-icon"><i class="fas fa-chart-pie"></i></span>
                <span class="nav-label">–ü–∞–Ω–µ–ª—å</span>
            </button>
            <button class="nav-item" data-page="history">
                <span class="nav-icon"><i class="fas fa-history"></i></span>
                <span class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</span>
            </button>
            <button class="nav-item" data-page="report">
                <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                <span class="nav-label">–û—Ç—á—ë—Ç</span>
            </button>
            <button class="nav-item" data-page="services">
                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                <span class="nav-label">–°–µ—Ä–≤–∏—Å—ã</span>
            </button>
        </nav>

        <!-- Add Button (+) -->
        <button id="add-transaction-btn" class="add-button">
            <i class="fas fa-plus"></i>
        </button>

        <!-- Notification -->
        <div id="notification" class="notification"></div>
    </div>

    <!-- === MODALS === -->

    <!-- Add Transaction Modal -->
    <div id="add-transaction-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="transaction-modal-title">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</div>
            </div>
            
            <!-- Type Tabs (One Line) -->
            <div class="modal-tabs">
                <button class="modal-tab income active" data-type="income">
                    <span class="modal-tab-icon"><i class="fas fa-arrow-up"></i></span>
                    <span>–î–æ—Ö–æ–¥</span>
                </button>
                <button class="modal-tab expense" data-type="expense">
                    <span class="modal-tab-icon"><i class="fas fa-arrow-down"></i></span>
                    <span>–†–∞—Å—Ö–æ–¥</span>
                </button>
                <button class="modal-tab savings" data-type="savings">
                    <span class="modal-tab-icon"><i class="fas fa-piggy-bank"></i></span>
                    <span>–ù–∞–∫–æ–ø–∏—Ç—å</span>
                </button>
            </div>
            
            <!-- Savings Target Selection -->
            <div id="savings-target-container" style="display: none;">
                <label class="form-label">–ö—É–¥–∞ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å?</label>
                <div class="savings-target-buttons">
                    <button id="savings-to-category" class="savings-target-btn active">–í –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    <button id="savings-to-goal" class="savings-target-btn">–í —Ü–µ–ª—å</button>
                </div>
            </div>
            
            <form id="add-transaction-form">
                <div class="form-group">
                    <label class="form-label">–°—É–º–º–∞</label>
                    <div class="amount-input">
                        <span class="currency-symbol" id="modal-currency-symbol">‚ÇΩ</span>
                        <input type="number" class="form-input" id="transaction-amount" placeholder="0" min="1" step="1" required>
                    </div>
                </div>
                
                <!-- Category/Goal Select -->
                <div class="form-group">
                    <label class="form-label" id="transaction-target-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-select" id="transaction-category" required>
                        <!-- Dynamic -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ—à–µ–ª—ë–∫</label>
                    <select class="form-select" id="transaction-wallet">
                        <!-- Dynamic -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" class="form-input" id="transaction-description" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ —Ñ–µ–≤—Ä–∞–ª—å">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" onclick="closeModal('add-transaction-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="modal-btn primary">
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="add-category-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="category-modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
            </div>
            
            <form id="add-category-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                    <input type="text" class="form-input" id="category-name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ñ–µ" maxlength="20" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icon-picker" id="icons-grid">
                        <!-- Dynamic -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç</label>
                    <div class="color-picker" id="color-grid">
                        <!-- Dynamic -->
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" onclick="closeModal('add-category-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="modal-btn primary">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Wallet Modal -->
    <div id="add-wallet-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</div>
            </div>
            
            <form id="add-wallet-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</label>
                    <input type="text" class="form-input" id="wallet-name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–∏–Ω—å–∫–æ—Ñ—Ñ" maxlength="20" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</label>
                    <div class="amount-input">
                        <span class="currency-symbol" id="wallet-currency-symbol">‚ÇΩ</span>
                        <input type="number" class="form-input" id="wallet-balance-input" placeholder="0" min="0" step="1" value="0">
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" onclick="closeModal('add-wallet-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="modal-btn primary">
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="add-goal-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ù–æ–≤–∞—è —Ü–µ–ª—å</div>
            </div>
            
            <form id="add-goal-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                    <input type="text" class="form-input" id="goal-name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω" maxlength="30" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞</label>
                    <div class="amount-input">
                        <span class="currency-symbol" id="goal-currency-symbol">‚ÇΩ</span>
                        <input type="number" class="form-input" id="goal-target-amount" placeholder="0" min="1" step="1" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°—Ä–æ–∫</label>
                    <select class="form-select" id="goal-deadline">
                        <option value="none">–ë–µ—Å—Å—Ä–æ—á–Ω–∞—è</option>
                        <option value="1month">1 –º–µ—Å—è—Ü</option>
                        <option value="3months">3 –º–µ—Å—è—Ü–∞</option>
                        <option value="6months">6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="1year">1 –≥–æ–¥</option>
                        <option value="custom">–£–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É</option>
                    </select>
                </div>
                
                <div class="form-group" id="custom-date-container" style="display: none;">
                    <label class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <input type="date" class="form-input" id="goal-custom-date">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" onclick="closeModal('add-goal-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="modal-btn primary">
                        –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- All Transactions Modal -->
    <div id="all-transactions-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
            </div>
            <div id="all-transactions-list">
                <!-- Dynamic -->
            </div>
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" onclick="closeModal('all-transactions-modal')">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>