<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–§–∏–Ω–∞–Ω—Å—ã ‚Ä¢ iOS 26</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div id="error-state" class="error-state" style="display: none;">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
        <div class="error-message" id="error-message"></div>
        <button class="retry-button" onclick="location.reload()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="app" style="display: none;">
        <!-- ==================== -->
        <!-- –°–¢–†–ê–ù–ò–¶–ê: –ü–ê–ù–ï–õ–¨ -->
        <!-- ==================== -->
        <div id="panel-page" class="page">
            <!-- –ë–∞–ª–∞–Ω—Å -->
            <div class="balance-overview">
                <div class="balance-amount" id="total-balance">0 ‚ÇΩ</div>
                <div class="balance-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
            </div>

            <!-- –î–æ—Ö–æ–¥—ã -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">–î–æ—Ö–æ–¥—ã</h2>
                    <button class="section-action" onclick="showAllCategories('income')">–í—Å–µ</button>
                </div>
                <div class="categories-grid" id="income-categories">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –†–∞—Å—Ö–æ–¥—ã -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">–†–∞—Å—Ö–æ–¥—ã</h2>
                    <button class="section-action" onclick="showAllCategories('expense')">–í—Å–µ</button>
                </div>
                <div class="categories-grid" id="expense-categories">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –ö–æ—à–µ–ª—å–∫–∏ -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">–ö–æ—à–µ–ª—å–∫–∏</h2>
                    <button class="section-action" onclick="showAllWallets()">–í—Å–µ</button>
                </div>
                <div class="wallets-list" id="wallets-list">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</h2>
                    <button class="section-action" onclick="showAllSavings()">–í—Å–µ</button>
                </div>
                <div class="goals-list" id="goals-list-panel">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                    <button class="section-action" onclick="showAllTransactions()">–í—Å–µ</button>
                </div>
                <div class="transactions-list" id="recent-transactions">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- ==================== -->
        <!-- –°–¢–†–ê–ù–ò–¶–ê: –ò–°–¢–û–†–ò–Ø -->
        <!-- ==================== -->
        <div id="history-page" class="page" style="display: none;">
            <!-- –ú–µ—Å—è—Ü -->
            <div class="month-selector">
                <button class="month-btn" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                <div class="month-display" id="current-month" onclick="showCalendar()">–§–µ–≤—Ä–∞–ª—å 2026</div>
                <button class="month-btn" id="next-month"><i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="period-selector">
                <button class="period-btn active" data-filter="all">–í—Å–µ</button>
                <button class="period-btn" data-filter="income">–î–æ—Ö–æ–¥—ã</button>
                <button class="period-btn" data-filter="expense">–†–∞—Å—Ö–æ–¥—ã</button>
            </div>

            <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
            <div class="transactions-container" id="history-transactions">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- ==================== -->
        <!-- –°–¢–†–ê–ù–ò–¶–ê: –û–¢–ß–Å–¢ -->
        <!-- ==================== -->
        <div id="report-page" class="page" style="display: none;">
            <!-- –í–∫–ª–∞–¥–∫–∏ -->
            <div class="report-tabs">
                <button class="report-tab active" data-tab="overview">–û–±–∑–æ—Ä</button>
                <button class="report-tab" data-tab="income">–î–æ—Ö–æ–¥—ã</button>
                <button class="report-tab" data-tab="expense">–†–∞—Å—Ö–æ–¥—ã</button>
                <button class="report-tab" data-tab="savings">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</button>
                <button class="report-tab" data-tab="balance">–ë–∞–ª–∞–Ω—Å</button>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="report-content">
                <!-- –û–±–∑–æ—Ä -->
                <div id="tab-overview" class="report-section active">
                    <!-- –ì—Ä–∞—Ñ–∏–∫ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è -->
                    <div class="chart-container">
                        <div class="chart-title">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ</div>
                        <div class="chart-wrapper">
                            <canvas id="ratio-chart"></canvas>
                        </div>
                        <div class="chart-legend" id="ratio-legend"></div>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-income">0 ‚ÇΩ</div>
                            <div class="stat-label">–î–æ—Ö–æ–¥—ã</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-expense">0 ‚ÇΩ</div>
                            <div class="stat-label">–†–∞—Å—Ö–æ–¥—ã</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-savings">0 ‚ÇΩ</div>
                            <div class="stat-label">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</div>
                        </div>
                    </div>
                </div>

                <!-- –î–æ—Ö–æ–¥—ã -->
                <div id="tab-income" class="report-section">
                    <div class="chart-container">
                        <div class="chart-title">–î–æ—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
                        <div class="chart-wrapper">
                            <canvas id="income-chart"></canvas>
                        </div>
                        <div class="chart-legend" id="income-legend"></div>
                    </div>
                </div>

                <!-- –†–∞—Å—Ö–æ–¥—ã -->
                <div id="tab-expense" class="report-section">
                    <div class="chart-container">
                        <div class="chart-title">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
                        <div class="chart-wrapper">
                            <canvas id="expense-chart"></canvas>
                        </div>
                        <div class="chart-legend" id="expense-legend"></div>
                    </div>
                </div>

                <!-- –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
                <div id="tab-savings" class="report-section">
                    <div class="chart-container">
                        <div class="chart-title">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</div>
                        <div class="chart-wrapper">
                            <canvas id="savings-chart"></canvas>
                        </div>
                        <div class="chart-legend" id="savings-legend"></div>
                    </div>

                    <!-- –¶–µ–ª–∏ -->
                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">–¶–µ–ª–∏</h2>
                            <button class="section-action" onclick="showAddGoalModal()"><i class="fas fa-plus"></i></button>
                        </div>
                        <div class="goals-list" id="goals-list-report"></div>
                    </div>
                </div>

                <!-- –ë–∞–ª–∞–Ω—Å -->
                <div id="tab-balance" class="report-section">
                    <div class="dynamics-container">
                        <div class="dynamics-header">
                            <div class="dynamics-title">–î–∏–Ω–∞–º–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∞</div>
                            <div class="dynamics-value" id="dynamics-value">0 ‚ÇΩ</div>
                        </div>
                        
                        <!-- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã -->
                        <div class="period-selector">
                            <button class="period-btn active" data-period="7days">7 –¥–Ω–µ–π</button>
                            <button class="period-btn" data-period="30days">30 –¥–Ω–µ–π</button>
                            <button class="period-btn" data-period="year">–ì–æ–¥</button>
                        </div>

                        <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                        <div class="chart-wrapper">
                            <canvas id="dynamics-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== -->
        <!-- –°–¢–†–ê–ù–ò–¶–ê: –ù–ê–°–¢–†–û–ô–ö–ò -->
        <!-- ==================== -->
        <div id="settings-page" class="page" style="display: none;">
            <div class="settings-container">
                <!-- –í–∞–ª—é—Ç–∞ -->
                <div class="setting-card">
                    <div class="setting-title">–í–∞–ª—é—Ç–∞</div>
                    <div class="currency-options">
                        <button class="currency-option active" data-currency="RUB">‚ÇΩ RUB</button>
                        <button class="currency-option" data-currency="USD">$ USD</button>
                        <button class="currency-option" data-currency="EUR">‚Ç¨ EUR</button>
                        <button class="currency-option" data-currency="GEL">‚Çæ GEL</button>
                    </div>
                </div>

                <!-- –≠–∫—Å–ø–æ—Ä—Ç -->
                <div class="setting-card">
                    <div class="setting-title">–î–∞–Ω–Ω—ã–µ</div>
                    <button class="setting-btn" onclick="exportData()">
                        <i class="fas fa-download"></i>
                        <span>–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</span>
                    </button>
                </div>

                <!-- –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
                <div class="setting-card">
                    <div class="setting-title">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
                    <div class="about-content">
                        <div class="app-icon">üí∞</div>
                        <div class="app-name">–§–∏–Ω–∞–Ω—Å—ã iOS 26</div>
                        <div class="app-version">–í–µ—Ä—Å–∏—è 3.0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="panel">
                <i class="nav-icon fas fa-chart-pie"></i>
                <span class="nav-label">–ü–∞–Ω–µ–ª—å</span>
            </button>
            <button class="nav-item" data-page="history">
                <i class="nav-icon fas fa-history"></i>
                <span class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</span>
            </button>
            <button class="nav-item" data-page="report">
                <i class="nav-icon fas fa-chart-line"></i>
                <span class="nav-label">–û—Ç—á—ë—Ç</span>
            </button>
            <button class="nav-item" data-page="settings">
                <i class="nav-icon fas fa-cog"></i>
                <span class="nav-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
        </nav>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <button id="add-button" class="add-button">
            <i class="fas fa-plus"></i>
        </button>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification" class="notification"></div>
    </div>

    <!-- ==================== -->
    <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
    <!-- ==================== -->

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
    <div id="add-transaction-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</div>
                <button class="modal-close" onclick="closeModal('add-transaction-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
            <div class="modal-tabs">
                <button class="modal-tab income active" data-type="income">
                    <i class="fas fa-arrow-up"></i>
                    <span>–î–æ—Ö–æ–¥</span>
                </button>
                <button class="modal-tab expense" data-type="expense">
                    <i class="fas fa-arrow-down"></i>
                    <span>–†–∞—Å—Ö–æ–¥</span>
                </button>
                <button class="modal-tab savings" data-type="savings">
                    <i class="fas fa-piggy-bank"></i>
                    <span>–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</span>
                </button>
            </div>

            <!-- –î–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π: –≤—ã–±–æ—Ä —Ç–∏–ø–∞ -->
            <div id="savings-type-container" style="display: none;">
                <div class="savings-type-selector">
                    <button class="savings-type-btn active" data-savings-type="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</button>
                    <button class="savings-type-btn" data-savings-type="goal">–¶–µ–ª—å</button>
                </div>

                <!-- –í—ã–±–æ—Ä —Ü–µ–ª–∏ -->
                <div id="goal-selection-container" style="display: none;">
                    <div class="goal-selection" id="goal-selection-list"></div>
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ -->
            <form id="transaction-form">
                <div class="form-group">
                    <label class="form-label">–°—É–º–º–∞</label>
                    <div class="amount-input">
                        <span class="currency-symbol">‚ÇΩ</span>
                        <input type="number" id="amount" placeholder="0" min="1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="category" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–æ—à–µ–ª—ë–∫</label>
                    <select id="wallet" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="description" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('add-transaction-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn-primary">
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div id="add-category-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                <button class="modal-close" onclick="closeModal('add-category-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="category-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="category-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ñ–µ" maxlength="20" required>
                </div>

                <div class="form-group">
                    <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icons-grid" id="category-icons"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç</label>
                    <div class="colors-grid" id="category-colors"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('add-category-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn-primary">
                        –°–æ–∑–¥–∞—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ -->
    <div id="add-wallet-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ù–æ–≤—ã–π –∫–æ—à–µ–ª—ë–∫</div>
                <button class="modal-close" onclick="closeModal('add-wallet-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="wallet-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="wallet-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–∏–Ω—å–∫–æ—Ñ—Ñ" maxlength="20" required>
                </div>

                <div class="form-group">
                    <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icons-grid" id="wallet-icons"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</label>
                    <div class="amount-input">
                        <span class="currency-symbol">‚ÇΩ</span>
                        <input type="number" id="wallet-balance" value="0" min="0">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('add-wallet-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn-primary">
                        –°–æ–∑–¥–∞—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ -->
    <div id="add-goal-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ù–æ–≤–∞—è —Ü–µ–ª—å</div>
                <button class="modal-close" onclick="closeModal('add-goal-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="goal-form">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                    <input type="text" id="goal-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω" maxlength="30" required>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞</label>
                    <div class="amount-input">
                        <span class="currency-symbol">‚ÇΩ</span>
                        <input type="number" id="goal-target" placeholder="0" min="1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–°—Ä–æ–∫</label>
                    <select id="goal-deadline">
                        <option value="none">–ë–µ–∑ —Å—Ä–æ–∫–∞</option>
                        <option value="1month">1 –º–µ—Å—è—Ü</option>
                        <option value="3months">3 –º–µ—Å—è—Ü–∞</option>
                        <option value="6months">6 –º–µ—Å—è—Ü–µ–≤</option>
                        <option value="1year">1 –≥–æ–¥</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
                    <div class="icons-grid" id="goal-icons"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç</label>
                    <div class="colors-grid" id="goal-colors"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('add-goal-modal')">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn-primary">
                        –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–∫–æ—à–µ–ª—å–∫–∏ -->
    <div id="all-items-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="all-items-title">–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã</div>
                <button class="modal-close" onclick="closeModal('all-items-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="all-items-list" id="all-items-list"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>